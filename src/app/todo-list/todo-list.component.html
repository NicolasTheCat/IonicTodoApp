<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Tâches à faire</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-button id="open-modal" expand="block">NOUVELLE TÂCHE</ion-button>
  <ion-modal trigger="open-modal">
    <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-buttons slot="start" >
              <ion-button type="reset" (click)="modalCancel()" >Cancel</ion-button>
            </ion-buttons>
            <ion-title>Nouvelle tâche</ion-title>
            <ion-buttons slot="end" >
              <ion-button type="submit" [strong]="true" form="taskForm" [disabled]="!taskForm.form.valid">Confirm</ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header> 
        <ion-content class="ion-padding">
          <form #taskForm="ngForm" (ngSubmit)="modalConfirm()" id="taskForm">
            <ion-item>
              <ion-input
                name="taskInput"
                label="Nom"
                labelPlacement="stacked"
                type="text"
                placeholder="Nom"
                [(ngModel)]="taskInput"
                required
              ></ion-input>
            </ion-item>
            <ion-item>
              <ion-input
                name="descInput"
                label="Description"
                labelPlacement="stacked"
                type="text"
                placeholder="Description"
                [(ngModel)]="descInput"
              ></ion-input>
            </ion-item>
            <ion-item>
              <ion-input
                name="scoreInput"
                label="Score"
                labelPlacement="stacked"
                type="number"
                placeholder="Score"
                [(ngModel)]="scoreInput"
                required
              ></ion-input>
            </ion-item>
            <ion-item>
              <ion-toggle name="hasDateInput" (ngModel)="dateInput" (click)="hasDateInput = !hasDateInput">Tâche avec échéance?</ion-toggle>
            </ion-item>
            <ion-datetime name="dateInput" class="{{hasDateInput ? '' : 'hideCalendar'}}" presentation="date" [(ngModel)]="dateInput" [required]="hasDateInput"></ion-datetime>
          </form>
        </ion-content>
    </ng-template>
  </ion-modal>



  <ion-list>
    <ion-list-header>
      <ion-select label="Tri :" [(ngModel)]="sort">
        <ion-select-option [value]="_sortEnum.NONE">Aucun</ion-select-option>
        <ion-select-option [value]="_sortEnum.UNCOMPLETED">Tâches à faire</ion-select-option>
        <ion-select-option [value]="_sortEnum.COMPLETED">Tâches effectuées</ion-select-option>
      </ion-select>
    </ion-list-header>
    @for (task of tasks; track $index) {
      <ion-accordion-group>
          <ion-item>
            <ion-accordion [value]="'accordion'+$index">
              <ion-item slot="header">
                <ion-label>{{ task.title }}</ion-label>
              </ion-item>
              <div slot="content">
                {{task.description || "Aucune description"}}
              </div>
            </ion-accordion>
            <ion-checkbox [(ngModel)]="task.done" justify="end"></ion-checkbox>
            <ion-button color="danger" (click)="removeTask(task.uuid)">
              <ion-icon slot="icon-only" name="trash"></ion-icon>
            </ion-button>
        </ion-item>
      </ion-accordion-group>
    }
  </ion-list>
</ion-content>